# Proxy Pattern

---

**접근을 제어하고 관리 ⇒ 프록시가 하는 역할**

- 원격 객체의 **프록시**만 넘기면 다른 머신에서도 상태 확인 가능.
- 프록시
    - 진짜 객체를 대신하는 역할.
    - 네트워크와 떨어져있는 `GumballMachine` 클래스의 정보를 주고받아야 함
    - 뽑기 기계가 서비스 역할 필요
    - 네트워크로 들어오는 요청 수용
    - 프록시 객체의 레퍼런스를 받아오는 기능 필요.

## 원격 프록시 역할

---

- 원격 객체의 로컬 대변자 역할. ⇒ 어떤 메소드를 호출하면 다른 원격 객체에서 그 메소드 호출을 전달하는 객체.
    - 원격 객체 ⇒ JVM의 힙에 존재하는 객체(다른 주소 공간에서 돌아가고 있는 객체)
    - 네트워크 통신과 같은 low level 작업은 프록시 객체에서 처리.

### 모니터링 코드에 원격 프록시 추가하기

- 다른 JVM에 들어있는 객체의 메소드를 호출하는 프록시 만들기 ⇒ RMI

### 원격 메소드 기초

- 로컬 객체의 메소드를 호출하면 그 요청을 원격 객체에 전달해주는 시스템을 디자인
- 통신을 처리해주는 보조 객체가 필요하고 보조 객체를 사용
    - 클라이언트는 로컬 객체의 메소드만 호출하면 됨.
    - 클라이언트 보조객체의 메소드를 호출. ⇒ 서비스 보조 객체 호출.
    - 진짜 원격 서비스인 척하는 객체 ⇒ **클라이언트 보조 객체**
    - 클라이언트 보조 객체는 서버에 연락을 취하고 메소드 호출에 관한 정보를 전달하고 서버로부터 리턴되는 정보를 기다림.
    - 서버 보조 객체는 소켓으로 연결된 보조 객체로부터 요청을 받아오고 호출 정보를 해석해서 진짜 메소드 호출

## RMI 개요

---

- 클라이언트와 서비스 보조 객체를 만들어주는 JAVA API
- 네트워킹 및 입출력 관련 코드 작성하지 않아도 JVM 메소드를 호출하듯 원격 메소드 호출 가능
- 클라이언트 보조 객체 ⇒ 스텁(stub)
  서버 보조 객체 ⇒ 스켈레톤(skeleton)

### 원격 서비스 만들기

1. **원격 인터페이스 만들기**
    1. 클라이언트가 원격으로 호출할 메소드 정의
    2. 인터페이스를 서비스의 클래스 형식으로 사영
2. **서비스 구현 클래스 만들기**
    1. 실제 작업 처리 클래스
3. **RMI 레지스트리 구성**
    1. 클라이언트는 레지스트리로부터 프록시(스텁, 클라이언트 보조객체)를 받아감.
4. **원격 서비스 실행하기**
    1. 서비스 객체 실행

⇒ `이후 RMI 구현은 책 참조`

## 프록시 패턴

---

<aside>
💡 **프록시 패턴**
특정 객체로의 접근을 제어하는 대리인을 제공. ⇒ 프록시

</aside>

프록시에 접근을 제어하는 몇가지 방법

1. 원격 프록시를 써서 원격 객체로의 접근을 제어
2. 가상 프록시를 써서 생성하기 힘든 자원으로의 접근을 제어
3. 보호 프록시를 써서 접근 권한이 필요한 자원으로의 접근을 제어

- RealSubject와 Proxy 인터페이스를 제공하는 Subject 인터페이스 존재
- 두 객체는 똑같은 인터페이스를 구현하기에 RealSubject가 들어가야할 자리에 Proxy를 대신 넣음
- 진짜 작업은 RealSubject가 처리. 대변인 역할이자 접근 제어

### 원격 프록시와 가**상 프록시 비교하기**

- **원격 프록시**
    - 다른 JVM에 들어있는 객체의 대리인에 해당하는 로컬 객체
- **가상 프록시**
    - 생성하는데 많은 비용이 드는 RealSubject를 대신하는 프록시 객체

### 앨범 커버 뷰어 만들기

- 네트워크의 상태와 인터넷 연결 속도에 따라서 앨범 커버 이미지를 가져오는데 시간이 걸릴 수 있음.
- 이미지를 불러오는 동안 화면에 다른 작업 진행.
- **가상 프록시**를 통해 개발

### 보호 프록시 만들기

- `java.lang.reflect` 패키지 안에 프록시 기능이 내장
- 즉석에서 하나 이상의 인터페이스를 구현하고 지정한 클래스에 메소드 호출을 전달하는 프록시 클래스 만들기 가능.
    - 진짜 프록시 클래스는 실행 중에 생성되므로 이러한 자바 기술을 **동적 프록시**라함.
- 자바에서 Proxy 클래스를 생성해주므로 Proxy 클래스에게 무슨 일을 해야하는지 알려줄 방법이 필요함.
    - `InvocationHandler`에 넣어주기
    - 프록시에 호출되는 모든 메소드에 응답.
- 클라이언트에서 아무 메소드나 마음대로 호출할 수도 있기에 **보호 프록시**가 필요
    - 접근 권한을 바탕으로 객체로의 접근을 제어하는 프록시
